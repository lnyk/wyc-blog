<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />

    

    

    <title>新年新气象，缅怀过去走进未来——换上Typecho | William Yao&#39;s Dream World</title>
    <meta name="author" content="William Yao" />
    <meta name="version" content="1.0.0" />
    <meta name="keywords" content="blog william yao dream world" />
    <meta name="description" content="
回顾2016年02月，丙申年正月初一。
因为很久没管系统的事儿了，今天睡醒觉，索性登到青岛服务器上，不看不知道啊，WordPress又把php-fpm给拖死了！重启服务之后，用了一上午时间，细细的思考了一下折腾ECS这两年都在干些什么。

记得从几年前受够了WebFaction共享主机到国内的牛车网速那一刻起，就开始了折腾之路，当时的阿里云资源还是比较好的，大概因为刚刚开拓市场，硬件资源还比较充足的缘故吧，试用一个月ECS之后，决定把服务器全都迁移到阿里云上。当时阿里云只有青岛和杭州两个区，作" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
    <meta name="baidu-site-verification" content="F0CXvmUgA9" />

    
    
    <link rel="icon" href="/favicon.ico">
    

    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

    <div class="app">
        <header class="header clearfix">
    <div id="nav" class="nav">
    <button id="open-panel" class="open-panel"><i class="icon-library"></i></button>

    <nav class="nav-inner">

        
        
        <li class="nav-item">
            <a class="nav-link" href="/">首页</a>
        </li>
        
        
        
        <li class="nav-item nav-item-tag">
            <a id="nav-tag" class="nav-link" href="#">标签</a>
            <div id="nav-tags" class="nav-tag-wrap">
                <i class="nav-tag-arrow"></i>
                
  <div class="widget-wrap">
    <h3 class="widget-title">
        <i class="icon-tag vm"></i>
        <span class="vm">标签</span>
    </h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/64-bit/">64-bit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/7-zip/">7-zip</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aliyun/">aliyun</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apache/">apache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aperture/">aperture</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/api/">api</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/app/">app</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/audio/">audio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/">c</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cache/">cache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/caj/">caj</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/calibre/">calibre</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ccnp/">ccnp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cdn/">cdn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos/">centos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cloud/">cloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/codec/">codec</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/convert/">convert</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cue/">cue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/diskutil/">diskutil</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dpkg/">dpkg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ecs/">ecs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/emacs/">emacs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/encrypt/">encrypt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/europe/">europe</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/evernote/">evernote</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fedora/">fedora</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flickr/">flickr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/game/">game</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gnome/">gnome</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/google/">google</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gravatar/">gravatar</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grub/">grub</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hdd/">hdd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hdiary/">hdiary</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hdmi/">hdmi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/https/">https</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ios/">ios</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iso/">iso</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/itunes/">itunes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/journal/">journal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kms/">kms</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/landscape/">landscape</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/life/">life</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/locale/">locale</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lxde/">lxde</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac/">mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/macports/">macports</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/motor/">motor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/movie/">movie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mozilla/">mozilla</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/music/">music</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/norway/">norway</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ocr/">ocr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/office/">office</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/onedrive/">onedrive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/papers/">papers</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pdf/">pdf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/photo/">photo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/photoshop/">photoshop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/portrait/">portrait</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/razer/">razer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sax/">sax</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/server/">server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ski/">ski</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/">socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/song/">song</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssl/">ssl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/steam/">steam</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/storage/">storage</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tex/">tex</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/theme/">theme</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tv/">tv</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typecho/">typecho</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/usb/">usb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/utf8/">utf8</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virtualenv/">virtualenv</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vnc/">vnc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vpc/">vpc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wordpress/">wordpress</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wsgi/">wsgi</a></li></ul>
    </div>
  </div>


            </div>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/categories/index.html">分类</a>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/archives/index.html">归档</a>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/atom.xml">订阅</a>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/about.html">关于</a>
        </li>
        
        
        

    </nav>
</div>

    <aside id="aside" class="aside">
    <div id="aside-mask" class="aside-mask"></div>
    <div id="aside-inner" class="aside-inner">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"><i class="icon-search-stroke"></i></button><input type="hidden" name="sitesearch" value="https://blog.williamyao.com"></form>

        
        
        
        

        
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#回顾"><span class="toc-number">1.</span> <span class="toc-text">回顾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开始折腾"><span class="toc-number">2.</span> <span class="toc-text">开始折腾</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#系统风格"><span class="toc-number">2.1.</span> <span class="toc-text">系统风格</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#具体操作"><span class="toc-number">3.</span> <span class="toc-text">具体操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#架好服务"><span class="toc-number">3.1.</span> <span class="toc-text">架好服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#迁移数据"><span class="toc-number">3.2.</span> <span class="toc-text">迁移数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#主题设置"><span class="toc-number">3.3.</span> <span class="toc-text">主题设置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#删除“打赏”按钮"><span class="toc-number">3.3.1.</span> <span class="toc-text">删除“打赏”按钮</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#支持侧边导航栏的自定义链接"><span class="toc-number">3.3.2.</span> <span class="toc-text">支持侧边导航栏的自定义链接</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#其他插件"><span class="toc-number">3.4.</span> <span class="toc-text">其他插件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#后记"><span class="toc-number">4.</span> <span class="toc-text">后记</span></a></li></ol>
        
    </div>
</aside>

</header>

        <div id="content" class="content"><article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            新年新气象，缅怀过去走进未来——换上Typecho
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="/2016/02/10/2016021001/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2016-02-10T07:14:12.000Z" itemprop="datePublished">2016-02-10</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/life/">life</a>, <a class="article-tag-link" href="/tags/nginx/">nginx</a>, <a class="article-tag-link" href="/tags/typecho/">typecho</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.css"><script src="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/js/Meting.min.js"></script><p><img src="https://wyc-blog.oss-cn-beijing.aliyuncs.com/images/2016021001/2016021001-01.jpg!w-1024" alt="William Yao"></p>
<h2 id="回顾"><a href="#回顾" class="headerlink" title="回顾"></a>回顾</h2><p>2016年02月，丙申年正月初一。</p>
<p>因为很久没管系统的事儿了，今天睡醒觉，索性登到青岛服务器上，不看不知道啊，WordPress又把php-fpm给拖死了！重启服务之后，用了一上午时间，细细的思考了一下折腾ECS这两年都在干些什么。</p>
<a id="more"></a>
<p>记得从几年前受够了WebFaction共享主机到国内的牛车网速那一刻起，就开始了折腾之路，当时的阿里云资源还是比较好的，大概因为刚刚开拓市场，硬件资源还比较充足的缘故吧，试用一个月ECS之后，决定把服务器全都迁移到阿里云上。当时阿里云只有青岛和杭州两个区，作为北方人，自然选择了青岛区，费了几天功夫搭建好基础服务，直接SSH到ECS上把几个django projects和两个WordPress迁移了回来。</p>
<p>速度自然是比国外服务器快多了，可为什么说折腾呢？因为原来外国的服务器，外国的域名商，不存在备案问题，这一下子全都迁移回了国内，不但工信部备案，按照北京市规定，还要去公安局备案。先后折腾了两个礼拜，才把全套手续拿下，传说中的<code>京ICP备</code>和更加传说中的<code>京公网安备</code>两个“身份证”也光荣的挂在了Footer上。唯一美中不足的，当时只是抱着试试看的心态去备案的，生活中也有不少事情占用时间，没有太多的精力管这些事儿，结果，就只备案了一个域名，剩下四套系统原来的域名统统挂不到服务器上了……</p>
<p>当时想，无所谓了，既然这样，干脆从头开始吧，于是暂时搁浅了所有的django项目，只保留了WordPress，毕竟好多年间写的几乎所有东西都在上面。启用了新域名<code>LNYK2.COM</code>，弄好了模板和插件。</p>
<p>其实反观自己，这些年来不管干啥，都想走一套极简的风格，而一旦折腾起来，却又乐此不疲……类似这样的矛盾，一次次的存在。就好像摄影，从最早的大变焦狗头，到最后只玩儿定焦纯手动，结果就是一大箱子镜头背着累死累活，看到变焦头还满头大汗的对人家嗤之以鼻；又好像出游，从最初“捏”张照片看景色那种单纯的快乐，一度演变成出游只为拍照，丢掉了旅行本身的乐趣，身边的人，也不再是出游最重要的陪伴，而仅仅成了画面中的模特；再好像django，架了nginx/Apache/PostgreSql一整套系统只为接个微信公众号的API！事后想想也是醉了。最后说写文章，从将近二十年前的纯HTML到CGI论坛，从ASP到PHP，从dotText到.Net Community Server再到自己写的Melody框架，从Confluence到MediaWiki最后到WordPress，期间丢了多少篇文章真是数不过来了，其实数据都留着，一直想着哪天有时间了，找台破本儿重新架起来所有东西，只为把当年的文字找回来。在这些年的“系统变革”中，其实我一直欣赏那种简约扁平的素雅风格，可是渐渐的WordPress后台装了若干插件，若干风格，让本就庞大的系统更加臃肿，同时为了弥补响应速度，底层各种Memcached/Accelerator吃光了本就不多的内存，造成访问延时，系统资源耗尽，就像这次。同样的，事后反观（我这人比较喜欢总结式的“马后炮”），本就没几个人访问的博客，折腾这些干啥？……</p>
<p>于是，在这“春意盎然”的新年新气象中，开始了新一轮的折腾，这次我决定，是该扔掉所有臃肿的累赘了。</p>
<h2 id="开始折腾"><a href="#开始折腾" class="headerlink" title="开始折腾"></a>开始折腾</h2><p>本来想写一篇纯“娱乐”的文字，放在Whispers里，写了第一节之后重新阅读才发现，居然又莫名其妙的朝着Ironware风格去了……干脆第二节就继续来些硬货吧。</p>
<h3 id="系统风格"><a href="#系统风格" class="headerlink" title="系统风格"></a>系统风格</h3><p>这次折腾，因为有一个明确的目标——极简，多余的东西统统不要，所以系统平台最终选择了这么几样：</p>
<blockquote>
<p>还是阿里云的ECS，这次开到了香港区，不为别的，就是不喜欢备案（虽然咱也是有“身份证”的人了），这样青岛区的服务器纯用来承载Git/django等其他服务，同时用作大陆方面的CDN.</p>
</blockquote>
<blockquote>
<p>除<code>LNYK2.COM</code>仍然解析给青岛区以外，包括<code>hk*.LNYK2.COM</code>在内所有域名统统解析到香港区，因为<code>LNYK2.COM</code>是有证的，做入口点及CDN没问题。</p>
</blockquote>
<blockquote>
<p>域名注册商转移到万网（阿里云），因为实在不喜欢Godaddy的收费策略，第一年便宜的要死，等骗你上了贼船，之后续费的时候再挣你的钱。</p>
</blockquote>
<blockquote>
<p>这次折腾的主角——博客系统，彻底扔掉了WordPress，简单几步把所有东西转到了Typecho上。</p>
</blockquote>
<p>关于Typecho在这里多说几句，先搬一下官方的广告词：</p>
<blockquote>
<p>仅仅7张数据表，加上不足400KB的代码，就实现了完整的插件与模板机制。超低的CPU和内存使用率，足以发挥主机的最高性能；原生支持Markdown排版语法，易读更易写。支持BAE/GAE/SAE等各类云主机，即使面对突如其来的高访问量，也能轻松应对；精心打磨过的操作界面，依然是你熟悉的面孔，更多了一份成熟与贴心。每一个像素的剪裁，都只为离完美更进一步。</p>
</blockquote>
<p>比起已经被我搞成大胖子的WordPress来说，Typecho这“哗哗”的运行速度和朴素到多余东西一点儿没有的后台风格，让我突然觉得找到了老相好~</p>
<p>再说主题，这次用的是<strong>Min童鞋修改的绛木子的仿简书风格</strong>，自己做了点儿小修改（下面会介绍），在这里对以上两位筒子的辛苦劳动表示一下由衷地感谢！</p>
<p>好吧，正式转到Ironware风格，我们开始吧！</p>
<h2 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h2><h3 id="架好服务"><a href="#架好服务" class="headerlink" title="架好服务"></a>架好服务</h3><p>还是不想折腾，直接上LNMP，弄好Nginx/PHP-FPM/MySQL；</p>
<p><a href="http://typecho.org" target="_blank" rel="noopener">Typecho官网</a>上下载最新版，我这里偷懒，直接从<a href="https://github.com/typecho/typecho" target="_blank" rel="noopener">Typecho on GitHub</a>上clone的<code>Master</code>，丢到<code>vhost</code>的root;</p>
<p>这里先别着急安装，因为LNMP的<code>[vhost].conf</code>是默认关闭<code>pathinfo</code>的，所以要先操作一下虚拟主机的配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /usr/<span class="built_in">local</span>/nginx/conf/vhost/[虚拟主机名].conf</span><br><span class="line">加 <span class="comment"># 注释掉 try_files $uri =404; 这一行</span></span><br><span class="line">去 <span class="comment"># 启用 include pathinfo.conf; 这一行</span></span><br><span class="line">sudo service nginx restart 或者 sudo lnmp nginx restart 重启一下服务</span><br></pre></td></tr></table></figure>
<p>这样之后，安装完Typecho就不会碰到<code>404</code>没法进后台的错误了。</p>
<p>之后的操作，假设你已经完成了Typecho的安装，系统一切正常。</p>
<h3 id="迁移数据"><a href="#迁移数据" class="headerlink" title="迁移数据"></a>迁移数据</h3><blockquote>
<p>以下操作在<code>香港区服务器</code>上</p>
</blockquote>
<p>首先是安装Typecho的插件，建议先装<a href="https://chekun.me/typecho-app-store.html" target="_blank" rel="noopener">AppStore</a>，这是Typecho的一个应用商店插件，用起来很方便。关于插件的安装，最标准的安装方式是把<code>[插件]</code>目录直接上传到<code>[typecho root]/usr/plugins/</code>中。先用这个方法装上应用商店，之后就可以从后台中启用应用商店插件，并直接依靠应用商店来装一些常用插件了，很方便。</p>
<p>如果连应用商店都不想装，那咱就直奔主题，下载安装<a href="http://docs.typecho.org/plugins/wordpress-to-typecho" target="_blank" rel="noopener">WordpressToTypecho</a>这个插件，启用之后进入插件配置，填写WordPress的数据库服务器相关信息，配置完了点运行，如果不出意外，插件顺利工作完毕会有提示，所有的文章和页面就都转换到Typecho上了。</p>
<p>我这里的操作相对复杂一点，因为不想把<strong>青岛区</strong>服务器的<code>3306</code>端口开放到公网，我是在<strong>青岛区</strong>服务器上另装了一套Typecho，迁移完数据后用<code>phpMyAdmin</code>导出、导入到<strong>香港区</strong>的，貌似阿里云的内网IP跨区是不互通的，也没想着深究<code>iptable/阿里云盾</code>之类的内容，对于这种问题我一贯奉行一个原则：</p>
<blockquote>
<p>如果一个看似巧妙的操作却会为问题本身引入更多的复杂度，那么<strong>Hard Operations</strong>往往是更好的解决办法。</p>
</blockquote>
<p>喝杯可乐，我们继续：）</p>
<p>到这里，数据库里的内容已经迁移完毕，接下来的是给文章中的附件“换门牌号”：</p>
<p><code>WordPress</code>的附件地址一般是<code>[WP root]/wp-content/uploads/</code></p>
<p><code>Typecho</code>的附件地址是<code>[Typecho root]/usr/uploads/</code></p>
<p>如果你的WordPress没有修改过默认上传路径，或者装过什么奇怪的插件的话，其上传目录中的结构和Typecho是完全一致的，全是<code>uploads/[年]/[月]</code>，这样就太方便了，直接把WordPress的<code>uploads/</code>所有东西统统复制到Typecho的<code>uploads/</code>里面，附件就都过来了。</p>
<p>然后打开phpMyAdmin或者直接myadmin之类操作MySQL的东西，使用查询语句，将原来文章中的附件地址替换成新的，以我为例，<code>blog.lnyk2.com</code>上的WordPress附件地址，替换成williamyao.com上的Typecho附件地址，查询这么写：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> typecho_contents <span class="keyword">SET</span> <span class="built_in">text</span> = <span class="keyword">REPLACE</span>(<span class="built_in">text</span>,<span class="string">'http://blog.lnyk2.com/wp-content/uploads/'</span>,<span class="string">'https://williamyao.com/usr/uploads/'</span>);</span><br></pre></td></tr></table></figure>
<p>执行完查询，回到Typecho前台，随便开个带附件的文章看看，观察一下附件地址，是不是已经全过来了？</p>
<p>恭喜你，到这一步，数据迁移全部完成！</p>
<h3 id="主题设置"><a href="#主题设置" class="headerlink" title="主题设置"></a>主题设置</h3><p>以下是关于<strong>Min 童鞋修改的绛木子的仿简书风格</strong>的小修改。</p>
<h4 id="删除“打赏”按钮"><a href="#删除“打赏”按钮" class="headerlink" title="删除“打赏”按钮"></a>删除“打赏”按钮</h4><p>貌似支付宝已经取消了捐赠功能？（还是我没找到，不得而知），总之觉得这个可爱的小功能有点儿不大符合咱这大叔模样的行事风格，贱贱的就把它删掉了，具体如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">修改 page.php 和 post.php</span><br><span class="line">分别找到 class 为 page-donate 和 post-donate 的 span 段，形如：</span><br><span class="line">page.php 中的 &lt;span class=&quot;page-donate&quot;&gt; ... &lt;/span&gt; 和 post.php 中的 &lt;span class=&quot;post-donate&quot;&gt; ... &lt;/span&gt;</span><br></pre></td></tr></table></figure>
<p>将这两个<code>&lt;span&gt;...&lt;/span&gt;</code>简单粗暴的整段删掉，在“赞”和“分享”中间的“赏”按钮就消失了，其他dialog之类的不用动，当然删的干净一点儿也无妨。</p>
<h4 id="支持侧边导航栏的自定义链接"><a href="#支持侧边导航栏的自定义链接" class="headerlink" title="支持侧边导航栏的自定义链接"></a>支持侧边导航栏的自定义链接</h4><p>这套主题在后台是可以自由切换侧边栏显示文章分类还是独立文章的，做的真的很贴心，忍不住再赞一个！但是对于大多数想要定制这个侧边栏的童鞋来说，只能动手改，好在改动不大。</p>
<p>因为主题本身支持<code>Links</code>插件，只不过插件定义的<strong>友情链接</strong>需要单独建立<code>slug</code>为<code>links</code>的独立页面，并且把链接聚合到这个单独页面中，这里我们正好可以利用<code>Links</code>插件，给她小小扩展一个新功能，支持选择是否把友情链接分类放到侧边栏！</p>
<p>不要紧张，修改步骤很简单，跟我来：</p>
<p>首先，满足一下我们的<strong>升级强迫症</strong>，将主题自带的<code>Font Awesome</code>替换为最新版本。<code>Font Awesome</code>维护一个字体和一整套应用，这个字体的特殊之处在于它包含的全是小图标！这套主题左侧导航栏开头的那些小图标，用的就是FA字体里的。</p>
<ul>
<li>从<a href="http://fontawesome.io/" target="_blank" rel="noopener">Font Awesome官网</a>上下载最新版；</li>
<li>用<code>fonts/</code>中的文件替换服务器上<code>[Typecho root]/usr/themes/jianshu/fonts/</code>中的同名文件；</li>
<li>用<code>css/</code>中的<code>font-awesome.min.css</code>文件替换服务器上<code>[Typecho root]/usr/themes/jianshu/css/</code>中的同名文件。</li>
</ul>
<p>其次，你要装上<a href="http://www.imhan.com/archives/typecho-links/" target="_blank" rel="noopener">HANNY的Links</a>插件，这也是这套主题默认支持，推荐安装的。</p>
<p>然后，用好一点的编辑器（记事本其实也行……）打开<code>Links/Plugin.php</code>找到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">output_str</span><span class="params">($pattern=NULL, $links_num=<span class="number">0</span>, $sort=NULL)</span></span></span><br></pre></td></tr></table></figure>
<p>这个函数，在前面的条件判断中新加一个判断条件：</p>
<p>函数原来的前几行：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">output_str</span><span class="params">($pattern=NULL, $links_num=<span class="number">0</span>, $sort=NULL)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  $options = Typecho_Widget::widget(<span class="string">'Widget_Options'</span>);</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">isset</span>($options-&gt;plugins[<span class="string">'activated'</span>][<span class="string">'Links'</span>])) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'友情链接插件未激活'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">isset</span>($pattern) || $pattern == <span class="string">""</span> || $pattern == <span class="keyword">NULL</span> || $pattern == <span class="string">"SHOW_TEXT"</span>) &#123;</span><br><span class="line">    $pattern = <span class="string">"&lt;li&gt;&lt;a href=\"&#123;url&#125;\" title=\"&#123;title&#125;\" target=\"_blank\"&gt;&#123;name&#125;&lt;/a&gt;&lt;/li&gt;\n"</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ($pattern == <span class="string">"SHOW_IMG"</span>) &#123;</span><br><span class="line">    $pattern = <span class="string">"&lt;li&gt;&lt;a href=\"&#123;url&#125;\" title=\"&#123;title&#125;\" target=\"_blank\"&gt;&lt;img src=\"&#123;image&#125;\" alt=\"&#123;name&#125;\" /&gt;&lt;/a&gt;&lt;/li&gt;\n"</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ($pattern == <span class="string">"SHOW_MIX"</span>) &#123;</span><br><span class="line">    $pattern = <span class="string">"&lt;li&gt;&lt;a href=\"&#123;url&#125;\" title=\"&#123;title&#125;\" target=\"_blank\"&gt;&lt;img src=\"&#123;image&#125;\" alt=\"&#123;name&#125;\" /&gt;&lt;span&gt;&#123;name&#125;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;\n"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们只需要在最后一个<code>else if</code>段后面再加一个<code>else if</code>，用来判断一个<code>FA_NAV</code>条件，把上面几行变成这样：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">output_str</span><span class="params">($pattern=NULL, $links_num=<span class="number">0</span>, $sort=NULL)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  $options = Typecho_Widget::widget(<span class="string">'Widget_Options'</span>);</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">isset</span>($options-&gt;plugins[<span class="string">'activated'</span>][<span class="string">'Links'</span>])) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'友情链接插件未激活'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">isset</span>($pattern) || $pattern == <span class="string">""</span> || $pattern == <span class="keyword">NULL</span> || $pattern == <span class="string">"SHOW_TEXT"</span>) &#123;</span><br><span class="line">    $pattern = <span class="string">"&lt;li&gt;&lt;a href=\"&#123;url&#125;\" title=\"&#123;title&#125;\" target=\"_blank\"&gt;&#123;name&#125;&lt;/a&gt;&lt;/li&gt;\n"</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ($pattern == <span class="string">"SHOW_IMG"</span>) &#123;</span><br><span class="line">    $pattern = <span class="string">"&lt;li&gt;&lt;a href=\"&#123;url&#125;\" title=\"&#123;title&#125;\" target=\"_blank\"&gt;&lt;img src=\"&#123;image&#125;\" alt=\"&#123;name&#125;\" /&gt;&lt;/a&gt;&lt;/li&gt;\n"</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ($pattern == <span class="string">"SHOW_MIX"</span>) &#123;</span><br><span class="line">    $pattern = <span class="string">"&lt;li&gt;&lt;a href=\"&#123;url&#125;\" title=\"&#123;title&#125;\" target=\"_blank\"&gt;&lt;img src=\"&#123;image&#125;\" alt=\"&#123;name&#125;\" /&gt;&lt;span&gt;&#123;name&#125;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;\n"</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ($pattern == <span class="string">"FA_NAV"</span>) &#123;</span><br><span class="line">    $pattern = <span class="string">"&lt;style&gt;.fa-nav_link_&#123;lid&#125;:before&#123;content: \"\\&#123;user&#125;\";&#125;&lt;/style&gt;&lt;a href=\"&#123;url&#125;\" target=\"_blank\" title=\"&#123;description&#125;\"&gt;&lt;i class=\"fa fa-nav_link_&#123;lid&#125;\"&gt; &lt;/i&gt; &lt;span class=\"title\"&gt; &#123;name&#125; &lt;/span&gt; &lt;/a&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>好了，插件修改就这么简单，接下来更简单：</p>
<p>打开主题的<code>header.php</code>，找到<code>&lt;div class=&quot;dropdown&quot; id=&quot;nav-menu&quot;&gt;</code>这一段，在本段最后<code>&lt;/div&gt;</code>之前加上下面这句：<code>&lt;?php Links_Plugin::output(FA_NAV,0,&#39;fa-nav&#39;);?&gt;</code></p>
<p>修改后的样子是这样：</p>
<p><img src="https://wyc-blog.oss-cn-beijing.aliyuncs.com/images/2016021001/2016021001-02.png!w-1024" alt="header.php"></p>
<p>修改好了？OK，一切搞定！那么怎么用呢？很简单！</p>
<p>打开后台的<strong>管理/友情链接</strong>，新建一个友情链接，在<strong>链接分类</strong>中填写<code>fa-nav</code>，在<strong>自定义数据</strong>中填写不带左斜杠的<strong>Unicode</strong>图标代码。</p>
<p>什么是图标代码？<a href="http://fontawesome.io/icons/" target="_blank" rel="noopener">Font Awesome官网图标页</a>有该字体的所有图标示例，你选好了哪一个，直接点图标进去，里面的<strong>Unicode</strong>后面就是字体代码：</p>
<p><img src="https://wyc-blog.oss-cn-beijing.aliyuncs.com/images/2016021001/2016021001-03.png!w-1024" alt="font-awesome"></p>
<p>填完了没？应该是这个样子：</p>
<p><img src="https://wyc-blog.oss-cn-beijing.aliyuncs.com/images/2016021001/2016021001-04.png!w-1024" alt="manage-links"></p>
<p>最后回到前台刷新，效果是这个样子：</p>
<p><img src="https://wyc-blog.oss-cn-beijing.aliyuncs.com/images/2016021001/2016021001-05.png!w-1024" alt="fa-nav"></p>
<p>会用了不？是不是很简单？Links插件所有功能一切正常，我们给它加了个功能，只要把<strong>链接分类</strong>写成<code>fa-nav</code>，并且给它一个<code>Font Awesome</code>的图标，它就会自动出现在左侧导航栏中！</p>
<blockquote>
<p>这里有个小Bug：想要出现在左侧导航栏中的链接，必须填写图标代码，不然显示的时候原来的图标位置会有点小瑕疵，想改改的筒子就自己上手试试吧。同时，链接默认是开新窗口（标签页）打开，如果想要同窗口打开，需要删掉<code>Links/Plugin.php</code>中那行代码的<code>&quot;target=_blank&quot;</code>属性。</p>
</blockquote>
<h3 id="其他插件"><a href="#其他插件" class="headerlink" title="其他插件"></a>其他插件</h3><p>Typecho的插件虽然都不算大，但好在一些不错的简单功能都能找到对应的插件：</p>
<p><img src="https://wyc-blog.oss-cn-beijing.aliyuncs.com/images/2016021001/2016021001-06.png!w-1024" alt="typecho-plugins"></p>
<p>这几个都挺不错的。</p>
<blockquote>
<p>这个主题需要装上<code>TeStat</code>插件，“阅读”和“点赞”统计才会生效。</p>
</blockquote>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>执着而不计成本，不为索取只为陶醉，有时候人就是应该活的简单些。</p>
<p>憋了小一年没更新文章，一回来就搞这么冗长的一片口水文，有失大雅，有碍观瞻，新春之际，望君海涵，但有不妥，欢迎拍砖！</p>
<p>最后，等到哪一天连这些都嫌烦了，就回归老路线，<code>TeX</code>直接输出PDF，把自己写的所有文章都放进去，看看若干年后能不能弄出本儿书来……</p>
<p><code>Jekyll</code>最近貌似很火？我总觉得，有折腾<code>Ruby Gem</code>和<code>github.io</code>的功夫，想写的东西早就写出来了，何必呢？</p>
<p>我其实是个喜欢用钢笔和牛皮纸本子写日记的人。</p>

        
    </section>
</article>



</div>
        <footer class="footer">
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, Theme by <a href="https://github.com/sanonz/hexo-theme-concise" target="_blank">Concise</a>
</footer>


    </div>

    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/1.9.0/jquery.min.js"></script>
    
    <script type="text/javascript" src="/js/scrollspy.min.js"></script>
    
    <script type="text/javascript">
        $(function() {
            var nodes = {
                nav: $('#nav'),
                aside: $('#aside'),
                navTags: $('#nav-tags')
            };

            $('#open-panel, #aside-mask').on('click', function() {
                nodes.aside.toggleClass('panel-show');
            });
            $('#nav-tag').on('click', function(event) {
                event.preventDefault();console.log(nodes.navTags.attr('class'))
                nodes.navTags.toggleClass('tag-show');console.log(nodes.navTags.attr('class'))
            })/*.hover(function() {
                nodes.navTags.addClass('tag-show');
            }, function() {
                nodes.navTags.removeClass('tag-show');
            });*/

            
            $(document.body).scrollspy({target: '#aside-inner'});
            
        });
    </script>

</body>
</html>
